import React, { useState, useMemo } from 'react';
import { Search, ExternalLink, AlertCircle, TrendingUp, DollarSign, Calendar, Info } from 'lucide-react';

const leadsData = [
  { organisation: "National Trust", title: "Director of Fundraising & Support", salary: "£110000", closing: "2026-02-15", link: "https://www.nationaltrustjobs.org.uk/", note: "Direct" },
  { organisation: "NSPCC", title: "Head of Philanthropy (Principal Gifts)", salary: "£68000", closing: "2026-02-22", link: "https://join-us.nspcc.org.uk/", note: "High Priority" },
  { organisation: "Cancer Research UK", title: "CEO (Chief Executive Officer)", salary: "£185000", closing: "2026-03-01", link: "https://www.cancerresearchuk.org/about-us/charity-jobs", note: "Direct" },
  { organisation: "British Heart Foundation", title: "Director of Development (International)", salary: "£85000", closing: "2026-02-28", link: "https://www.bhf.org.uk/about-us/jobs", note: "Principal Track" },
  { organisation: "Save the Children UK", title: "Deputy CEO & COO", salary: "£125000", closing: "2026-02-20", link: "https://www.savethechildren.org.uk/about-us/jobs", note: "Leadership" },
  { organisation: "UNICEF UK", title: "Head of Alumni & Supporter Relations", salary: "£55000", closing: "2026-03-10", link: "https://www.unicef.org.uk/jobs/", note: "Alumni Specialty" },
  { organisation: "Oxfam GB", title: "Principal Gifts Lead (Ultra High Net Worth)", salary: "£62000", closing: "2026-02-25", link: "https://jobs.oxfam.org.uk/", note: "UHNW Specialty" },
  { organisation: "Macmillan Cancer Support", title: "Head of Corporate Partnerships", salary: "£64000", closing: "2026-03-05", link: "https://jobs.macmillan.org.uk/", note: "Corporate, Urgent" },
  { organisation: "Dogs Trust", title: "Celebrity & Ambassador Engagement Lead", salary: "£46000", closing: "2026-02-18", link: "https://www.dogstrust.org.uk/about-us/jobs", note: "Celebrity Track" },
  { organisation: "Alzheimer's Society", title: "Director of Fundraising Operations", salary: "£82000", closing: "2026-02-27", link: "https://www.alzheimers.org.uk/about-us/jobs", note: "Operations" },
  { organisation: "Stowe School", title: "Deputy Development Director", salary: "Competitive", closing: "2024-11-03", link: "https://www.stowe.co.uk/our-people/working-for-us/current-vacancies/deputy-development-director", note: "Re-advertised Potential" },
  { organisation: "Roedean School", title: "Director of Development", salary: "Competitive", closing: "2025-09-01", link: "https://roedean.co.uk/wp-content/uploads/2025/09/Director-of-Development-Job-Pack-Sep-25.pdf", note: "Stagnant Check" },
  { organisation: "Chesham Grammar School", title: "Development Director", salary: "£45072", closing: "2025-09-29", link: "https://www.tes.com/jobs/vacancy/development-director-buckinghamshire-2247611", note: "School Track" },
  { organisation: "Francis Holland Schools Trust", title: "Development Manager", salary: "£40000", closing: "2023-09-15", link: "https://www.francisholland.org.uk/wp-content/uploads/Development-Manager-Information-Pack-September-2023-1.pdf", note: "Historical Track" },
  { organisation: "Kimbolton School", title: "Head of Development & Alumni", salary: "Competitive", closing: "2025-05-15", link: "https://kimboltonschool.com/wp-content/uploads/2025/05/Application-Pack.pdf", note: "Alumni specialty" },
  { organisation: "University of Birmingham", title: "Head of Philanthropy Asia", salary: "£63606", closing: "2026-01-19", link: "https://www.charityjob.co.uk/head-of-fundraising-jobs", note: "Philanthropy" },
  { organisation: "Royal Albert Hall", title: "Head of Philanthropy", salary: "£82000", closing: "2026-02-03", link: "https://www.charityjob.co.uk/head-of-fundraising-jobs", note: "Urgent" },
  { organisation: "ClientEarth", title: "Head of Philanthropy", salary: "£76431", closing: "2026-02-02", link: "https://www.charityjob.co.uk/head-of-fundraising-jobs", note: "Extended" },
  { organisation: "Maggie's", title: "Head of Philanthropy", salary: "£80738", closing: "2026-01-25", link: "https://www.charityjob.co.uk/head-of-fundraising-jobs", note: "High Turnaround" },
  { organisation: "Blue Cross", title: "Head of Philanthropy", salary: "£60000", closing: "2026-01-28", link: "https://www.charityjob.co.uk/head-of-fundraising-jobs", note: "Re-advertised" },
  { organisation: "The Children's Society", title: "Philanthropy Lead", salary: "£56000", closing: "2026-01-30", link: "https://www.charityjob.co.uk/jobs/philanthropy-lead/", note: "Direct" },
  { organisation: "Practical Action", title: "Head of Philanthropy", salary: "£65000", closing: "2026-01-21", link: "https://www.charityjob.co.uk/jobs/head-of-philanthropy/", note: "Principal Gifts" },
  { organisation: "Sightsavers", title: "Head of Principal Gifts", salary: "£70000", closing: "2026-02-02", link: "https://www.charityjob.co.uk/jobs/head-of-principal-gifts/", note: "Strategic" },
  { organisation: "NACE", title: "Chief Executive (CEO)", salary: "£100000", closing: "2026-01-23", link: "https://www.charityjob.co.uk/jobs/chief-executive/", note: "CEO Track" },
  { organisation: "Mesothelioma UK", title: "Chief Executive", salary: "£75000", closing: "2026-01-30", link: "https://www.charityjob.co.uk/jobs/chief-executive/", note: "CEO Track" },
  { organisation: "Young Camden Foundation", title: "Interim CEO (Maternity cover)", salary: "£60000", closing: "2026-02-05", link: "https://www.charityjob.co.uk/jobs/interim-ceo/", note: "Consultancy Opportunity" },
  { organisation: "Oundle School", title: "Deputy Director of Development", salary: "£60000", closing: "2026-01-21", link: "https://idpe.org.uk/ocd.aspx?action=check_bulletin", note: "School Lead" },
  { organisation: "King Edward VI Foundation", title: "Director of Development and Alumni Relations", salary: "Competitive", closing: "2026-01-16", link: "https://idpe.org.uk/ocd.aspx?action=check_bulletin", note: "Alumni specialty" },
  { organisation: "Coventry School Foundation", title: "Foundation Development Manager", salary: "£55000", closing: "2026-01-19", link: "https://idpe.org.uk/ocd.aspx?action=check_bulletin", note: "Development" },
  { organisation: "Transport Action Network", title: "CEO", salary: "£50000", closing: "2026-02-01", link: "https://www.charityjob.co.uk/jobs/ceo/", note: "CEO Track" },
  { organisation: "The Eveson Trust", title: "Chief Executive Officer (CEO)", salary: "£75000", closing: "2026-02-02", link: "https://www.charityjob.co.uk/jobs/chief-executive-officer/", note: "CEO Track" },
  { organisation: "Action for Stammering Children", title: "Deputy CEO", salary: "£48000", closing: "2026-01-25", link: "https://www.charityjob.co.uk/jobs/deputy-ceo-jobs", note: "Leadership" },
  { organisation: "Refugee Action", title: "Trusts and Philanthropy Manager", salary: "£45282", closing: "2026-01-25", link: "https://www.charityjob.co.uk/jobs/trusts-and-philanthropy-manager/", note: "Trusts Track" },
  { organisation: "WWF-UK", title: "Corporate Partnerships Manager", salary: "£48000", closing: "2026-01-19", link: "https://www.charityjob.co.uk/jobs/corporate-partnerships-manager/", note: "Corporate Track" },
  { organisation: "WaterAid", title: "Head of Corporate Partnerships", salary: "£63000", closing: "2026-01-30", link: "https://www.charityjob.co.uk/jobs/head-of-corporate-partnerships/", note: "Corporate Lead" },
  { organisation: "Population Matters", title: "Head of Fundraising and Engagement", salary: "£55000", closing: "2023-11-14", link: "https://iof.charityjob.co.uk/jobs/population-matters/", note: "Re-advertised Check" }
];

export default function App() {
  const [searchTerm, setSearchTerm] = useState('');
  const [sortConfig, setSortConfig] = useState({ key: 'organisation', direction: 'asc' });

  const filteredLeads = useMemo(() => {
    return leadsData.filter(lead => 
      lead.organisation.toLowerCase().includes(searchTerm.toLowerCase()) ||
      lead.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
      lead.note.toLowerCase().includes(searchTerm.toLowerCase())
    ).sort((a, b) => {
      if (a[sortConfig.key] < b[sortConfig.key]) return sortConfig.direction === 'asc' ? -1 : 1;
      if (a[sortConfig.key] > b[sortConfig.key]) return sortConfig.direction === 'asc' ? 1 : -1;
      return 0;
    });
  }, [searchTerm, sortConfig]);

  const stats = useMemo(() => ({
    total: leadsData.length,
    urgent: leadsData.filter(l => {
      const n = l.note.toLowerCase();
      return n.includes('urgent') || n.includes('high priority') || n.includes('re-advertised');
    }).length,
    ceo: leadsData.filter(l => l.title.toLowerCase().includes('ceo')).length,
    highValue: leadsData.filter(l => {
      const val = parseInt(l.salary.replace(/[^0-9]/g, ''));
      return !isNaN(val) && val >= 80000;
    }).length
  }), []);

  const requestSort = (key) => {
    let direction = 'asc';
    if (sortConfig.key === key && sortConfig.direction === 'asc') {
      direction = 'desc';
    }
    setSortConfig({ key, direction });
  };

  const getUrgencyStyles = (note) => {
    const n = note.toLowerCase();
    if (n.includes('urgent') || n.includes('high priority') || n.includes('re-advertised')) {
      return 'bg-red-50 text-red-700 border-red-200';
    }
    if (n.includes('direct')) {
      return 'bg-emerald-50 text-emerald-700 border-emerald-200';
    }
    return 'bg-slate-50 text-slate-700 border-slate-200';
  };

  return (
    <div className="min-h-screen bg-slate-50 font-sans text-slate-900 p-4 md:p-8">
      <div className="max-w-7xl mx-auto">
        {/* Header Section */}
        <div className="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-6">
          <div>
            <h1 className="text-4xl font-black tracking-tight text-slate-900 uppercase italic leading-none flex items-center gap-3">
              Recruitment Intelligence
              <span className="text-xs font-bold px-3 py-1 bg-blue-600 text-white rounded-full tracking-widest not-italic">V16.0 MASTER</span>
            </h1>
            <p className="text-slate-500 mt-3 font-medium flex items-center gap-2">
              <TrendingUp size={16} /> 9-Month Historical Registry & Senior Track Analytics
            </p>
          </div>
          
          <div className="relative group w-full md:w-96">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors" size={18} />
            <input 
              type="text" 
              placeholder="Search charities, roles, or signals..."
              className="w-full bg-white border border-slate-200 rounded-2xl py-3 pl-12 pr-4 shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
        </div>

        {/* Stats Grid */}
        <div className="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
          {[
            { label: 'Master Tracks', val: stats.total, icon: <Info size={16} />, color: 'text-slate-600' },
            { label: 'Urgent/Priority', val: stats.urgent, icon: <AlertCircle size={16} />, color: 'text-red-600' },
            { label: 'CEO/Leadership', val: stats.ceo, icon: <TrendingUp size={16} />, color: 'text-blue-600' },
            { label: '£80k+ High Value', val: stats.highValue, icon: <DollarSign size={16} />, color: 'text-emerald-600' }
          ].map((stat, i) => (
            <div key={i} className="bg-white p-5 rounded-3xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow">
              <div className="flex items-center gap-2 mb-1">
                <span className={`${stat.color} opacity-60`}>{stat.icon}</span>
                <span className="text-[10px] font-black uppercase tracking-widest text-slate-400">{stat.label}</span>
              </div>
              <div className={`text-3xl font-black ${stat.color}`}>{stat.val}</div>
            </div>
          ))}
        </div>

        {/* Spreadsheet View */}
        <div className="bg-white rounded-[2.5rem] shadow-xl border border-slate-200 overflow-hidden">
          <div className="overflow-x-auto custom-scrollbar">
            <table className="w-full text-left border-collapse min-w-[1000px]">
              <thead>
                <tr className="bg-slate-50 border-b border-slate-100">
                  {[
                    { label: 'Organisation', key: 'organisation' },
                    { label: 'Job Title', key: 'title' },
                    { label: 'Salary', key: 'salary' },
                    { label: 'Closing Date', key: 'closing' },
                    { label: 'Intel Note', key: 'note' },
                    { label: 'Link', key: null }
                  ].map((head, i) => (
                    <th 
                      key={i} 
                      onClick={() => head.key && requestSort(head.key)}
                      className={`px-6 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest cursor-pointer hover:text-slate-900 transition-colors ${head.key ? 'select-none' : ''}`}
                    >
                      <div className="flex items-center gap-2">
                        {head.label}
                        {sortConfig.key === head.key && (
                          <span className="text-blue-500">{sortConfig.direction === 'asc' ? '↑' : '↓'}</span>
                        )}
                      </div>
                    </th>
                  ))}
                </tr>
              </thead>
              <tbody className="divide-y divide-slate-50">
                {filteredLeads.map((lead, idx) => (
                  <tr key={idx} className="group hover:bg-slate-50/80 transition-all">
                    <td className="px-6 py-5">
                      <div className="font-black uppercase italic text-sm text-slate-800 tracking-tight leading-none mb-1 group-hover:text-blue-600 transition-colors">
                        {lead.organisation}
                      </div>
                      <div className="flex gap-2">
                        {lead.note.toLowerCase().includes('direct') && (
                          <span className="text-[7px] font-black text-emerald-600 uppercase tracking-tighter">Direct Ad</span>
                        )}
                        {lead.title.toLowerCase().includes('ceo') && (
                          <span className="text-[7px] font-black text-blue-600 uppercase tracking-tighter">Leadership</span>
                        )}
                      </div>
                    </td>
                    <td className="px-6 py-5 font-bold text-slate-600 text-sm tracking-tight leading-tight">
                      {lead.title}
                    </td>
                    <td className="px-6 py-5">
                      <div className="flex items-center gap-1.5 text-slate-900 font-black tracking-tight italic">
                        <DollarSign size={14} className="text-slate-400" />
                        {lead.salary}
                      </div>
                    </td>
                    <td className="px-6 py-5">
                      <div className="flex items-center gap-1.5 text-slate-500 text-xs font-bold">
                        <Calendar size={14} className="opacity-50" />
                        {lead.closing}
                      </div>
                    </td>
                    <td className="px-6 py-5">
                      <span className={`px-3 py-1 rounded-full text-[9px] font-black uppercase border tracking-tight ${getUrgencyStyles(lead.note)}`}>
                        {lead.note}
                      </span>
                    </td>
                    <td className="px-6 py-5 text-right">
                      <a 
                        href={lead.link} 
                        target="_blank" 
                        rel="noopener noreferrer"
                        className="inline-flex items-center gap-2 bg-slate-900 text-white px-4 py-2 rounded-xl text-[10px] font-black uppercase hover:bg-blue-600 hover:shadow-lg transition-all"
                      >
                        Source <ExternalLink size={12} />
                      </a>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          {filteredLeads.length === 0 && (
            <div className="py-20 text-center text-slate-400 font-bold italic uppercase tracking-widest text-xs">
              No matching intelligence found.
            </div>
          )}
        </div>

        {/* Footer Info */}
        <div className="mt-8 flex justify-between items-center px-4">
          <div className="text-[10px] font-black text-slate-400 uppercase tracking-widest">
            Database Last Sync: {new Date().toLocaleDateString()}
          </div>
          <div className="flex gap-4">
            <button className="text-[10px] font-black text-slate-400 hover:text-slate-900 uppercase tracking-widest transition-colors">Export Selection</button>
            <button className="text-[10px] font-black text-slate-400 hover:text-slate-900 uppercase tracking-widest transition-colors">Bulk Update</button>
          </div>
        </div>
      </div>
    </div>
  );
}
